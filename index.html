<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="The most useless file packaging format ever, but cool if I say so myself">
    <meta name="theme-color" content="#1a1a2e">
    <title>Nyx Packer</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>📦</text></svg>">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <header class="app-header">
        <div class="container header-container">
            <h1 class="logo">
                <span class="logo-icon" aria-hidden="true">📦</span>
                Nyx Packer
            </h1>
            <p class="tagline">Create & Extract .nyx containers with ease.</p>
        </div>
    </header>

    <main class="container">
        <div class="workstation">
            <nav class="view-switcher">
                <button id="switchToCreate" class="switcher-btn active" aria-pressed="true">
                    <span aria-hidden="true">⚡</span> Create Package
                </button>
                <button id="switchToImport" class="switcher-btn" aria-pressed="false">
                    <span aria-hidden="true">📂</span> Import Package
                </button>
                <button id="switchToEdit" class="switcher-btn" aria-pressed="false">
                    <span aria-hidden="true">✏️</span> Edit Package
                </button>
            </nav>

            <!-- ======================================================= -->
            <!-- ====================== CREATE VIEW ====================== -->
            <!-- ======================================================= -->
            <section id="create-view" class="view active-view">
                <div class="drop-zone-wrapper">
                    <div id="uploadZone" class="drop-area" role="button" tabindex="0" aria-label="Drag and drop files or folders here, or click to browse">
                        <div class="drop-zone-content">
                            <div class="drop-zone-icon" aria-hidden="true">📁</div>
                            <p class="drop-zone-text">Drag & drop files or folders here</p>
                            <p class="drop-zone-subtext">or click to browse</p>
                        </div>
                    </div>
                    <input id="fileInput" type="file" multiple class="sr-only">
                </div>

                <div id="fileList" class="file-list"></div>

                <div class="create-options">
                    <label for="splitSize">Max shard size (MB):</label>
                    <input type="number" min="0" id="splitSize" class="form-input" placeholder="e.g., 100">
                    <label for="encryptionPassword">Encrypt Content (Optional):</label>
                    <input type="password" id="encryptionPassword" class="form-input" placeholder="Enter password">
                    <span id="totalSizeInfo" class="size-info"></span>
                    <span id="shardInfo" class="size-info"></span>
                </div>

                <div class="view-actions">
                    <button id="configureMetadataBtn" class="btn btn-secondary" disabled>
                        <span aria-hidden="true">✏️</span> Configure Metadata
                    </button>
                    <button id="createBtn" class="btn btn-primary" disabled>
                        <span aria-hidden="true">📦</span> Create Package
                    </button>
                    <button id="clearBtn" class="btn btn-secondary">
                        <span aria-hidden="true">🗑️</span> Clear All
                    </button>
                </div>
                
                <div id="createProgress" class="progress-container hidden" role="status" aria-live="polite">
                    <span id="progressText" class="progress-text">Preparing...</span>
                    <div class="progress-bar" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                </div>

                <div id="masterKeyArea" class="master-key-area hidden">
                    <h4>🔑 Your Master Key</h4>
                    <p>Save this key! It is required to edit the package later. <strong>It cannot be recovered.</strong></p>
                    <div class="key-display">
                        <input id="masterKeyOutput" type="text" readonly aria-label="Generated Master Key">
                        <button id="copyKeyBtn" class="btn btn-secondary" title="Copy Master Key" aria-label="Copy Master Key">Copy</button>
                    </div>
                </div>

                <div id="downloadArea" class="download-area"></div>
            </section>

            <!-- ======================================================= -->
            <!-- ====================== IMPORT VIEW ====================== -->
            <!-- ======================================================= -->
            <section id="import-view" class="view">
                <div class="drop-zone-wrapper">
                     <div id="importZone" class="drop-area" role="button" tabindex="0" aria-label="Select one or more .nyx shards to import">
                        <div class="drop-zone-content">
                            <div class="drop-zone-icon" aria-hidden="true">📄</div>
                            <p class="drop-zone-text">Drag & drop .nyx files here</p>
                            <p class="drop-zone-subtext">or click to select</p>
                        </div>
                    </div>
                    <input id="importInput" type="file" accept=".nyx" class="sr-only" multiple>
                </div>

                <div id="pkgInfo" class="package-info" aria-live="polite"></div>
                
                <div id="customDataContainer" class="custom-data-container hidden">
                    <h4>Custom JSON Data</h4>
                    <pre id="customDataContent"></pre>
                </div>

                 <div id="importPasswordPrompt" class="key-verification hidden">
                    <h4>🔒 Content Encrypted</h4>
                    <p>Enter the password to preview or save files from this package.</p>
                    <div class="form-group">
                        <input type="password" id="importPasswordInput" class="form-input" placeholder="Enter content password">
                        <button id="unlockContentBtn" class="btn btn-primary">Unlock</button>
                    </div>
                </div>

                <div id="pkgPreview" class="package-preview">
                    <div class="preview-header hidden" id="previewHeader">
                        <h3>File Preview</h3>
                        <button id="clearPreviewBtn" class="btn btn-small btn-secondary">
                            <span aria-hidden="true">❌</span> Clear
                        </button>
                    </div>
                    <div id="previewContent"></div>
                </div>
            </section>
            
            <!-- ===================================================== -->
            <!-- ====================== EDIT VIEW ====================== -->
            <!-- ===================================================== -->
            <section id="edit-view" class="view">
                <div class="drop-zone-wrapper">
                    <div id="editZone" class="drop-area" role="button" tabindex="0" aria-label="Select a single .nyx package or all its shards to edit">
                        <div class="drop-zone-content">
                            <div class="drop-zone-icon" aria-hidden="true">✏️</div>
                            <p class="drop-zone-text">Drop a .nyx package or all its shards here</p>
                            <p class="drop-zone-subtext">or click to select</p>
                        </div>
                    </div>
                    <input id="editInput" type="file" accept=".nyx" class="sr-only" multiple>
                </div>

                <div id="editKeyVerification" class="key-verification hidden">
                    <h4>🔑 Master Key Required</h4>
                    <p>Enter the master key for this package to unlock editing.</p>
                    <div class="form-group">
                        <input type="password" id="masterKeyInput" class="form-input" placeholder="Enter 42-character master key">
                        <button id="verifyKeyBtn" class="btn btn-primary">Verify</button>
                    </div>
                </div>

                <div id="editFormContainer" class="hidden" data-locked="true">
                    <h3>📝 Edit Package Metadata</h3>
                    <form id="metadataForm">
                        <div class="metadata-form-grid">
                            <div class="form-group">
                                <label for="pkgName">Package Name</label>
                                <input type="text" id="pkgName" class="form-input" placeholder="e.g., Project Files Q3">
                            </div>
                             <div class="form-group">
                                <label for="pkgAuthor">Author</label>
                                <input type="text" id="pkgAuthor" class="form-input" placeholder="e.g., John Doe">
                            </div>
                            <div class="form-group full-width">
                                <label for="pkgDescription">Description</label>
                                <textarea id="pkgDescription" class="form-input" rows="2" placeholder="A short description of the package contents."></textarea>
                            </div>
                             <div class="form-group">
                                <label for="pkgSource">Source</label>
                                <input type="text" id="pkgSource" class="form-input" placeholder="e.g., https://github.com/user/repo">
                            </div>
                             <div class="form-group">
                                <label for="pkgTags">Tags (comma-separated)</label>
                                <input type="text" id="pkgTags" class="form-input" placeholder="e.g., backup, assets, urgent">
                            </div>
                             <div class="form-group">
                                <label for="pkgVersion">Version</label>
                                <input type="number" id="pkgVersion" class="form-input" placeholder="e.g., 2">
                            </div>
                             <div class="form-group">
                                <label for="pkgCreated">Creation Date</label>
                                <input type="datetime-local" id="pkgCreated" class="form-input">
                            </div>
                            <div class="form-group full-width">
                                <label for="pkgCustomData">Custom JSON Data</label>
                                <textarea id="pkgCustomData" class="form-input" rows="3" placeholder='{ "project_id": 123, "status": "review" }'></textarea>
                            </div>
                        </div>
                    </form>

                    <div id="editEncryptionSection" class="key-verification">
                        <h4>🔒 Encryption Settings</h4>
                        <p id="editEncryptionStatus" class="form-note"></p>
                        <div class="password-fields-container">
                            <div id="editOldPasswordGroup" class="form-group hidden">
                                <label for="editOldPassword">Old:</label>
                                <input type="password" id="editOldPassword" class="form-input" placeholder="Enter current content password">
                            </div>
                            <div class="form-group">
                                <label for="editNewPassword">New:</label>
                                <input type="password" id="editNewPassword" class="form-input" placeholder="Enter new password (or leave blank to remove)">
                            </div>
                        </div>
                    </div>

                     <div class="view-actions">
                        <button id="saveChangesBtn" class="btn btn-primary">
                            <span aria-hidden="true">💾</span> Save Changes
                        </button>
                        <button id="clearEditBtn" class="btn btn-secondary">
                            <span aria-hidden="true">🗑️</span> Clear
                        </button>
                    </div>
                </div>
                 <div id="editDownloadArea" class="download-area"></div>
            </section>
        </div>
    </main>

    <!-- Toast Notifications -->
    <div id="toastContainer" class="toast-container"></div>
    
    <!-- Template for file list items -->
    <template id="file-item-template">
        <div class="file-item">
            <div class="file-icon" aria-hidden="true"></div>
            <div class="file-meta">
                <div class="file-name"></div>
                <div class="file-size"></div>
            </div>
            <button class="btn btn-small btn-danger" data-action="remove" title="Remove File" aria-label="Remove File">
                <span aria-hidden="true">🗑️</span>
            </button>
        </div>
    </template>

    <!-- External Dependencies -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js" referrerpolicy="no-referrer" defer></script>
    <script src="app.js" defer></script>
</body>
</html>